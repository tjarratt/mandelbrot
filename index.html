<html>
  <head>
    <script src=https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.1.1/math.js></script>
    <script type=application/javascript>
        const TODO = [
            "full height / width canvas",
            "upon iterations keep note of which points can be skipped -- pure black",
            "delay re-rendering points upon iterations which are pure red",
            "research ways to speed up rendering within a single iteration",
            "pan support",
            "zoom support",
            "full-bleed canvas -- css reset-ish",
        ];
        TODO.forEach(item => console.log("TODO :", item));
    </script>
    <script type=application/javascript>
        let max_iterations = 10;

        function mandelbrot(x, y) {
            let z = math.complex(0, 0);
            let n = 0;
            let c = math.complex(x, y);
            while (math.abs(z) <= 2 && n < max_iterations) {
                z = math.add(z.pow(2), c);
                n += 1;
            }

            return n;
        }

        function draw() {
            console.log("drawing at resolution", max_iterations);
            let canvas = document.getElementsByTagName("canvas")[0];
            let context = canvas.getContext('2d', {alpha: false});
    
            let origin_x = canvas.width / 2.0;
            let origin_y = canvas.height / 2.0;
            let min_x = -2.0;
            let min_y = -1.0;
            let max_x = 1.0;
            let max_y = 1.0;

            for (let i = 0; i < canvas.width; i ++) {
                for (let j = 0; j < canvas.height; j++) {
                    let x = min_x + (i / canvas.width) * (max_x - min_x);
                    let y = min_y + (j / canvas.height) * (max_y - min_y);

                    let val = mandelbrot(x, y);
                    let hue = parseInt(255.0 * val / max_iterations);
                    let saturation = '100%';
                    let value = val < max_iterations ? '50%' : '0%';
                    context.fillStyle = `hsl(${hue}, ${saturation}, ${value})`;
                    context.fillRect(i, j, 1, 1);
                }
            }

            if (max_iterations >= 80) return;
            max_iterations *= 2;
            setTimeout(draw, 10);
        }

        function init() {
            console.log("init");
            let canvas = document.getElementsByTagName("canvas")[0];
            canvas.width = window.screen.width / 2;
            canvas.height = canvas.width * 2 / 3;
            draw();
        }
    </script>
  </head>

  <body onload=init();>
    <canvas width=600 height=400 />
  </body>

</html>
